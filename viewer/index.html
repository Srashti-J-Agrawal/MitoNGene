---
layout: default
title: Data Viewer
---

<link href="https://cdn.jsdelivr.net/npm/tabulator-tables@6.3.0/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tabulator-tables@6.3.0/dist/js/tabulator.min.js"></script>

<style>
  :root{
    --container-max: 1400px;
    --surface: #ffffff;
    --text: #111827;
    --muted: #6b7280;
    --border: #e5e7eb;
    --bg: #f8fafc;
    --shadow: 0 10px 30px rgba(0,0,0,0.08);
    --radius: 14px;
  }

  body{
    background: var(--bg);
    color: var(--text);
  }

  .wrap{
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 22px 18px 28px;
  }

  /* Brand header */
  .brandbar{
    display:flex;
    align-items:center;
    gap:14px;
    padding: 16px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  .brandbar img{
    width: 56px;
    height: 56px;
    object-fit: contain;
    border-radius: 12px;
    background: #fff;
  }
  .brandtext{
    display:flex;
    flex-direction:column;
    gap:4px;
    min-width: 0;
  }
  #title{
    margin: 0;
    font-size: 1.65rem;
    line-height: 1.15;
    letter-spacing: -0.02em;
  }
  #desc{
    margin: 0;
    color: var(--muted);
    font-size: 0.98rem;
    line-height: 1.35;
  }

  /* Error */
  .error{
    margin-top: 14px;
    padding: 12px 14px;
    border: 1px solid #fca5a5;
    background: #fff5f5;
    border-radius: 12px;
  }

  /* Controls */
  .controls{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:flex-end;
    margin: 14px 0 10px;
  }
  .controls label{
    display:flex;
    flex-direction:column;
    gap:6px;
    font-size: 0.92rem;
    color: var(--muted);
  }
  input, select{
    padding: 9px 10px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: var(--surface);
    color: var(--text);
    min-width: 220px;
    outline: none;
  }
  select{ min-width: 140px; }
  input:focus, select:focus{
    border-color: #93c5fd;
    box-shadow: 0 0 0 3px rgba(147,197,253,0.35);
  }

  /* Table card */
  #tableCard{
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 10px;
  }
  #table{
    margin-top: 6px;
  }

  /* Tabulator readability tweaks (CSS only) */
  .tabulator{
    font-size: 0.92rem;
  }
  .tabulator .tabulator-header{
    border-bottom: 1px solid var(--border);
  }
  .tabulator .tabulator-header .tabulator-col{
    background: #f9fafb;
    border-right: 1px solid var(--border);
  }
  .tabulator .tabulator-row{
    border-bottom: 1px solid #f3f4f6;
  }
  .tabulator .tabulator-row:hover{
    background: #f9fafb;
  }
  .tabulator .tabulator-cell{
    padding-top: 8px;
    padding-bottom: 8px;
  }

  /* Modal: keep your inline styles working, just improve typography a bit */
  #modalBody{
    font-size: 0.95rem;
    line-height: 1.45;
    color: var(--text);
  }

  /* Small screens */
  @media (max-width: 640px){
    .brandbar{ padding: 14px; }
    .brandbar img{ width: 48px; height: 48px; }
    input{ min-width: 100%; }
    select{ min-width: 100%; }
  }
</style>

<div class="wrap">

  <div id="err" class="error" style="display:none"></div>

  <div class="controls">
    <label>Global search
      <input id="globalFilter" placeholder="Type to filter rows..." />
    </label>
    <label>Rows per page
      <select id="pageSize">
        <option>25</option>
        <option selected>50</option>
        <option>100</option>
        <option>200</option>
      </select>
    </label>
  </div>

  <div id="tableCard">
    <div id="table"></div>
  </div>

</div>

<!-- Modal for expanded cell text -->
<div id="modalBackdrop" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:9999; padding:20px; align-items:center; justify-content:center;">
  <div style="background:#fff; max-width:900px; width:100%; max-height:80vh; overflow:auto; border-radius:10px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,0.25);">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:10px;">
      <h3 id="modalTitle" style="margin:0;">Full text</h3>
      <button id="modalClose" type="button" style="padding:6px 10px; cursor:pointer;">Close</button>
    </div>
    <pre id="modalBody" style="white-space:pre-wrap; word-wrap:break-word; background:#f6f8fa; padding:12px; border-radius:8px; margin:0;"></pre>
  </div>
</div>

<script>
  function showErr(msg){
    var el = document.getElementById("err");
    el.style.display = "block";
    el.textContent = msg;
  }

  function param(name){
    return new URL(window.location.href).searchParams.get(name);
  }

  function tsvToObjects(text){
    var lines = text.trim().split(/\r?\n/);
    if(lines.length < 2) return [];
    var headers = lines[0].split("\t");
    var out = [];
    for(var r=1; r<lines.length; r++){
      var cells = lines[r].split("\t");
      var obj = {};
      for(var i=0; i<headers.length; i++){
        obj[headers[i]] = (cells[i] !== undefined ? cells[i] : "");
      }
      out.push(obj);
    }
    return out;
  }

  var PREVIEW_LEN = 140;

  function previewText(s){
    s = String(s || "");
    if(s.length <= PREVIEW_LEN) return s;
    return s.slice(0, PREVIEW_LEN) + "…";
  }

  function escapeHtml(s){
    return String(s || "").replace(/</g,"&lt;").replace(/>/g,"&gt;");
  }

  function setupModal(){
    var backdrop = document.getElementById("modalBackdrop");
    var closeBtn = document.getElementById("modalClose");
    var titleEl = document.getElementById("modalTitle");
    var bodyEl = document.getElementById("modalBody");

    function close(){
      backdrop.style.display = "none";
      titleEl.textContent = "Full text";
      bodyEl.textContent = "";
    }

    closeBtn.addEventListener("click", close);
    backdrop.addEventListener("click", function(e){ if(e.target === backdrop) close(); });
    document.addEventListener("keydown", function(e){ if(e.key === "Escape") close(); });

    return function open(fieldName, fullText){
      titleEl.textContent = "Full text — " + fieldName;
      bodyEl.textContent = String(fullText || "");
      backdrop.style.display = "flex";
    };
  }

  async function main(){
    var file = param("file");
    var title = param("title") || "Dataset";
    var desc  = param("desc")  || "";

    var titleEl = document.getElementById("title");
    var descEl  = document.getElementById("desc");
    if(titleEl) titleEl.textContent = title;
    if(descEl)  descEl.textContent  = desc;

    if(!file){
      showErr("No file specified. Add ?file=../sheets/yourfile.tsv");
      return;
    }

    if(typeof Tabulator === "undefined"){
      showErr("Tabulator failed to load. Check network/CDN access.");
      return;
    }

    var res = await fetch(file, {cache:"no-store"});
    if(!res.ok){
      showErr("Could not load file (" + res.status + "): " + file);
      return;
    }

    var text = await res.text();

    // If we accidentally fetched HTML (like a 404 page), show it
    var head = text.slice(0, 40).toLowerCase();
    if(head.indexOf("<!doctype") !== -1 || head.indexOf("<html") !== -1){
      showErr("Fetched HTML instead of TSV. Check the file path: " + file);
      return;
    }

    var data = tsvToObjects(text);
    if(!data.length){
      showErr("Loaded file but found 0 rows. Check TSV formatting.");
      return;
    }

    var headers = Object.keys(data[0]);
    var openModal = setupModal();

    // Columns to truncate + expand
    var TRUNCATE_COLS = {
      "Patient_Description": true,
      "Columns": true,
      "HGVS_NM": true
    };

    var columns = headers.map(function(h){
      if(TRUNCATE_COLS[h]){
        return {
          title: h,
          field: h,
          headerFilter: true,
          sorter: "string",
          formatter: function(cell){
            var full = String(cell.getValue() || "");
            var shown = escapeHtml(previewText(full));
            return (
              '<span ' +
              'style="cursor:pointer; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block; max-width:520px;" ' +
              'title="Click to expand">' +
              shown +
              '</span>'
            );
          },
          cellClick: function(e, cell){
            openModal(h, cell.getValue());
          }
        };
      }

      return {title:h, field:h, headerFilter:true, sorter:"string"};
    });

    var table = new Tabulator("#table",{
      data: data,
      columns: columns,
      layout: "fitDataStretch",
      pagination: true,
      paginationSize: 50,
      height: "70vh"
    });

    document.getElementById("pageSize").addEventListener("change", function(e){
      table.setPageSize(parseInt(e.target.value,10));
    });

    var input = document.getElementById("globalFilter");
    input.addEventListener("input", function(){
      var q = input.value.toLowerCase();
      if(!q){ table.clearFilter(true); return; }
      table.setFilter(function(row){
        var vals = Object.values(row);
        for(var i=0; i<vals.length; i++){
          if(String(vals[i]).toLowerCase().indexOf(q) !== -1) return true;
        }
        return false;
      });
    });
  }

  main();
</script>
