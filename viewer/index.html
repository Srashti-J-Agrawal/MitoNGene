---
layout: default
title: Data Viewer
---

<link href="https://cdn.jsdelivr.net/npm/tabulator-tables@6.3.0/dist/css/tabulator.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tabulator-tables@6.3.0/dist/js/tabulator.min.js"></script>

<style>
  .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:12px 0}
  input,select{padding:8px}
  #table{margin-top:12px}
  .note{font-size:0.95em;opacity:0.9}
  .error{padding:10px;border:1px solid #d33;background:#fff5f5;border-radius:8px}
</style>

<h1 id="title">Dataset</h1>
<p id="desc" class="note"></p>
<div id="err" class="error" style="display:none"></div>

<div class="controls">
  <label>Global search:
    <input id="globalFilter" placeholder="Type to filter rows..." />
  </label>
  <label>Rows per page:
    <select id="pageSize">
      <option>25</option>
      <option selected>50</option>
      <option>100</option>
      <option>200</option>
    </select>
  </label>
</div>

<div id="table"></div>

<script>
  function showErr(msg){
    var el = document.getElementById("err");
    el.style.display = "block";
    el.textContent = msg;
  }

  function param(name){
    return new URL(window.location.href).searchParams.get(name);
  }

  function tsvToObjects(text){
    var lines = text.trim().split(/\r?\n/);
    var headers = lines[0].split("\t");
    var out = [];
    for(var r=1; r<lines.length; r++){
      var cells = lines[r].split("\t");
      var obj = {};
      for(var i=0; i<headers.length; i++){
        obj[headers[i]] = (cells[i] !== undefined ? cells[i] : "");
      }
      out.push(obj);
    }
    return out;
  }

  async function main(){
    var file = param("file");
    var title = param("title") || "Dataset";
    var desc  = param("desc")  || "";

    document.getElementById("title").textContent = title;
    document.getElementById("desc").textContent  = desc;

    if(!file){
      showErr("No file specified. Add ?file=../sheets/yourfile.tsv");
      return;
    }

    if(typeof Tabulator === "undefined"){
      showErr("Tabulator failed to load. Check network/CDN access.");
      return;
    }

    var res = await fetch(file, {cache:"no-store"});
    if(!res.ok){
      showErr("Could not load file (" + res.status + "): " + file);
      return;
    }

    var text = await res.text();
    // If we accidentally fetched HTML (like a 404 page), show it
    if(text.slice(0, 20).toLowerCase().indexOf("<!doctype") !== -1 ||
       text.slice(0, 20).toLowerCase().indexOf("<html") !== -1){
      showErr("Fetched HTML instead of TSV. Check the file path: " + file);
      return;
    }

    var data = tsvToObjects(text);
    if(!data.length){
      showErr("Loaded file but found 0 rows. Check TSV formatting.");
      return;
    }

    var headers = Object.keys(data[0]);
    var columns = headers.map(function(h){
      return {title:h, field:h, headerFilter:true, sorter:"string"};
    });

    var table = new Tabulator("#table",{
      data:data,
      columns:columns,
      layout:"fitDataStretch",
      pagination:true,
      paginationSize:50,
      height:"70vh"
    });

    document.getElementById("pageSize").addEventListener("change", function(e){
      table.setPageSize(parseInt(e.target.value,10));
    });

    var input = document.getElementById("globalFilter");
    input.addEventListener("input", function(){
      var q = input.value.toLowerCase();
      if(!q){ table.clearFilter(true); return; }
      table.setFilter(function(row){
        var vals = Object.values(row);
        for(var i=0; i<vals.length; i++){
          if(String(vals[i]).toLowerCase().indexOf(q) !== -1) return true;
        }
        return false;
      });
    });
  }

  main();
</script>
